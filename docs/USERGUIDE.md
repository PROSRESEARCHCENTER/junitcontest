# User guide

## Try it via Docker (to run the following commands in servers we suggest to use [Screen](https://www.howtoforge.com/linux_screen))

For easier access and use, we have dockerized the contest infrastructure. Here are the instructions for testing your tool via docker:

### Prerequisites

Install the docker software on your machine. Docker is available for Linux, Mac and Windows. For installation please follow the instructions for your operating system:
- Windows: https://docs.docker.com/docker-for-windows/install/
- Mac: https://docs.docker.com/docker-for-mac/install/
- Linux/Ubuntu: https://docs.docker.com/install/linux/docker-ce/ubuntu/#extra-steps-for-aufs

Additionally, you will need Java 8 and Maven to build the Docker image. 

### Build the Docker image

To build the docker image, first build the tools used in the infrastructure using the following command:
```shell script
git clone https://github.com/JUnitContest/junitcontest 
cd junitcontext
mvn package
``` 
It will produce the following artifacts: `benchmarktool/target/benchmarktool-1.0.0-shaded.jar`.

Then run the following command from the root directory of this repository:
```shell script
docker build -f Dockerfile -t junitcontest/infrastructure:latest .
```
It will produce a Docker image with the benchmark located at [`infrastructure/benchmarks`](../infrastructure/benchmarks). To change the classes under test, simply update [`infrastructure/benchmarks`](../infrastructure/benchmarks). For instance, with the CUTs of a previous edition of the competition available in [`infrastructure/`](../infrastructure/).

### Running a tool

The command to run the docker image that contains the junit contest infrastructure is the following:
```shell script
docker run \
  -v /path/to/host/folder:/path/to/container/folder \
  --name=junitcontest \
  -it junitcontest/infrastructure:latest
```

* -v: it is needed to specify the tool folder in the host machine that needs to be attached to the docker container. For example:
```shell script
docker run \
  -v ~/Desktop/randoop/:/home/randoop \
  --name=junitcontest \
-it junitcontest/infrastructure:latest
```

The `randoop` folder under the Desktop folder in host machine is mapped to the `randoop` folder under the home folder in the docker container (guest). The `randoop` folder in the host machine is shared with the container, therefore every file written in this folder will be in both the host and the guest machines.

* `--name=junitcontest`: it is the name of the container (`junitcontest` in this case). The name is optional, if skipped Docker assigns a random name automatically.

* `-it`: it means that the user can access the docker container interactively, as if the user was in the command line of the guest system.

* `junitcontest/infrastructure:latest`: it is the name of the docker image. The first time the command is run, Docker tries automatically to download the image from a public repository. Once the image is in the system, docker simply uses it. You can also build the Docker image following the [procedure described here above](#build-the-docker-image).

In case a container with the same name is already running and you want to remove it:
#stop container with 
```shell script
docker container ls
docker container stop $(docker container ls -aq)	
docker system prune
docker container ls
```

Once you execute the docker run command, you are in the docker container. Move to the container folder where you mapped the tool, using the `-v` option (in the example is `/home/randoop`). The tool folder must meet the requirements specified in [DETAILS.md](DETAILS.md) . For an example of a correct tool folder please see: [RANDOOP](/tools/randoop).
(If you use the `randoop` tool from the github repository above, make sure to change the variable `JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64` to `JAVA_HOME=/usr` in the `runtool` script)

If the tool satisfies the requirements, **run from the tool folder (`/home/randoop`) in the container**:
```shell script
contest_generate_tests.sh \
  <tool-name> \
  <runs-number> \
  <runs-start-from> \
  <time-budget-seconds>
```

For example:
```shell script
cd /home/randoop 
contest_generate_tests.sh randoop 1 1 10
```
This script runs one execution of the test generation tool `randoop` for 10 seconds.

As the generation goes on, you should see files written in the shared folder in the host machine (in the example `~/Desktop/randoop`).

### Compute metrics

To compute the metrics (i.e., coverage and mutation score) for the test cases generated by the command in the previous example, run the following command, **run from the tool same directory (`/home/randoop`)**:
```shell script
contest_compute_metrics.sh results_randoop_10 > stat_log.txt 2> error_log.txt
```
Note that the folder `results_randoop_10` is automatically generated by the `contest_generate_tests.sh` script and contains, among other things, the test cases generated.

### Test Cases Generated and Statistical results:
Test Cases generated
-	results_randoop_10 -> *Project name*   ->  temp -> testcases

Results stored:
-	results_randoop_10 -> *Project name*   ->  Metrics -> transcript.csv
-	results_randoop_10 -> *Project name*   -> Metrics -> log_detailed.txt

### How to leverage several copies of the docker image of the infrustructure (e.g., to experiment with different time budgets or tools)

We show example of steps for Randoop with 3 different time budgets and 10 runs. 
Each of the following run executes in its own copy of the randoop/ folder (randoop60, randoop180, and randoop300)

1) Commands to clone the container in the local repository with tag 2021:
```shell script
docker commit junitcontest junitcontest:2021
```

2) Docker image for 60 seconds time budget (a similar command for 180 and 300 can be executed)

```shell script
docker run \
  -v ~/Desktop/randoop60/:/home/randoop \
  --name=junitcontest60 \
-it junitcontest:2021
```

3) As previously seen, in the container, execute for 60 seconds time budget (a similar command for 180 and 300 can be executed after creating corresponding images):

```shell script
contest_generate_tests.sh randoop 10 1 60
contest_compute_metrics.sh results_randoop_60 > stat_log.txt 2> error_log.txt
```

### Other commands

Once you are done, you can exit from the container by running:
```shell script
exit
```
The command brings you back to the host machine.

Optionally you can remove the container by running:
```shell script
docker rm <container-name>
```
For the example, run:
```shell script
docker rm junitcontest
```
Other docker commands:
```shell script
docker ps: shows all running containers
docker ps -a: shows all containers (in every status)
```

## Try it via manual installation

You can also install the contest infrastructure directly on your machine and test your tool. Below you find basic information and detailed instructions.

Target: Linux (Ubuntu x64)

Folder contents:

* [bin](/infrastructure):   Contest infrastructure binaries
* [src](/):   Contest infrastructure source code
* [tools](/tools): Contest tools

Requirements:

Java8 (JDK):
```shell script
apt-get install default-jdk
```

Installation instructions:

For detailed instructions see [DETAILS](/DETAILS)
